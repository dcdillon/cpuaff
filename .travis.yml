# .travis.yml for cpuaff
#
# See eg http://docs.travis-ci.com/user/languages/cpp/
#
# This is much simplified (rake-free) version of the example at 
# https://github.com/rubinius/rubinius/blob/master/.travis.yml
#
# Dirk Eddelbuettel, 31 Jan 2015

language: cpp

compiler:
  - gcc
  - clang

before_install:
  - echo $LANG
  - echo $LC_ALL
  - sudo apt-get update && sudo apt-get install -y automake autoconf libhwloc-dev
  - if [ $CXX == g++ ]; then sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test; sudo apt-get update -qq; fi
  - sudo pip install codecov

install:
  - if [ $CXX == g++ ]; then sudo apt-get install g++-4.9; export CXX="g++-5"; fi
  - sudo update-alternatives --install /usr/bin/gcov gcov /usr/bin/gcov-5 90

before_script:
  - if [ $TRAVIS_OS_NAME == linux ]; then ./bootstrap.sh; fi

script: 
  - ./configure && make CXXFLAGS="-fprofile-arcs -ftest-coverage" LDFLAGS="-lgconv" && make check && ./cleanup.sh && ./bootstrap.sh && ./configure --with-hwloc && make && make check
  - for filename in `find . | egrep '\.cpp'`; do gcov-5 -n -o . $filename > /dev/null; done
  - codecov

notifications:
  email:
    on_success: change
    on_failure: change

os:
  - linux

